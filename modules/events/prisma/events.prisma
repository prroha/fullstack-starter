// =============================================================================
// Events Module - Prisma Schema
// =============================================================================
// Standalone schema for the schema merger. No datasource/generator blocks.
// Models reference User by foreign key (userId).

// -----------------------------------------------------------------------------
// Enums
// -----------------------------------------------------------------------------

enum EventStatus {
  DRAFT
  PUBLISHED
  CANCELLED
  COMPLETED
  ARCHIVED
}

enum EventType {
  IN_PERSON
  VIRTUAL
  HYBRID
}

enum RegistrationStatus {
  PENDING
  CONFIRMED
  CANCELLED
  WAITLISTED
  ATTENDED
}

// -----------------------------------------------------------------------------
// Category
// -----------------------------------------------------------------------------

model EventCategory {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  name        String
  slug        String
  description String?
  color       String   @default("#6B7280")
  sortOrder   Int      @default(0) @map("sort_order")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  events Event[]

  @@index([userId])
  @@unique([userId, slug])
  @@map("events_categories")
}

// -----------------------------------------------------------------------------
// Venue
// -----------------------------------------------------------------------------

model EventVenue {
  id         String   @id @default(uuid())
  userId     String   @map("user_id")
  name       String
  address    String?
  city       String?
  state      String?
  country    String?
  capacity   Int?
  isVirtual  Boolean  @default(false) @map("is_virtual")
  meetingUrl String?  @map("meeting_url")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  events Event[]

  @@index([userId])
  @@map("events_venues")
}

// -----------------------------------------------------------------------------
// Event
// -----------------------------------------------------------------------------

model Event {
  id          String      @id @default(uuid())
  userId      String      @map("user_id")
  categoryId  String?     @map("category_id")
  venueId     String?     @map("venue_id")
  title       String
  slug        String
  description String?
  type        EventType   @default(IN_PERSON)
  status      EventStatus @default(DRAFT)
  startDate   DateTime    @map("start_date")
  endDate     DateTime    @map("end_date")
  capacity    Int?
  price       Int         @default(0)
  currency    String      @default("USD")
  imageUrl    String?     @map("image_url")
  isFeatured  Boolean     @default(false) @map("is_featured")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  category      EventCategory?     @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  venue         EventVenue?        @relation(fields: [venueId], references: [id], onDelete: SetNull)
  registrations EventRegistration[]
  speakers      EventSpeaker[]

  @@index([userId])
  @@index([categoryId])
  @@index([venueId])
  @@index([status])
  @@index([startDate])
  @@map("events_events")
}

// -----------------------------------------------------------------------------
// Registration
// -----------------------------------------------------------------------------

model EventRegistration {
  id                 String             @id @default(uuid())
  eventId            String             @map("event_id")
  userId             String             @map("user_id")
  status             RegistrationStatus @default(PENDING)
  registrationNumber String             @unique @map("registration_number")
  attendeeName       String             @map("attendee_name")
  attendeeEmail      String             @map("attendee_email")
  notes              String?
  checkedInAt        DateTime?          @map("checked_in_at")
  createdAt          DateTime           @default(now()) @map("created_at")
  updatedAt          DateTime           @updatedAt @map("updated_at")

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([eventId])
  @@index([userId])
  @@index([status])
  @@map("events_registrations")
}

// -----------------------------------------------------------------------------
// Speaker
// -----------------------------------------------------------------------------

model EventSpeaker {
  id        String   @id @default(uuid())
  eventId   String   @map("event_id")
  userId    String   @map("user_id")
  name      String
  email     String?
  bio       String?
  avatarUrl String?  @map("avatar_url")
  title     String?
  company   String?
  sortOrder Int      @default(0) @map("sort_order")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([eventId])
  @@map("events_speakers")
}

// -----------------------------------------------------------------------------
// Settings (per-user config)
// -----------------------------------------------------------------------------

model EventSettings {
  id                String   @id @default(uuid())
  userId            String   @unique @map("user_id")
  defaultView       String   @default("LIST") @map("default_view")
  defaultCategoryId String?  @map("default_category_id")
  currency          String   @default("USD")
  timezone          String   @default("UTC")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  @@map("events_settings")
}
